<div class="p-3 md:p-4 border-b border-gray-200 dark:border-gray-700">
  <div class="relative">
    <ng-icon
      name="lucideSearch"
      class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
      size="20"
    />
    <input
      hlmInput
      type="text"
      [value]="searchQuery()"
      (input)="onSearchInput($event)"
      placeholder="Search users by username..."
      class="w-full pl-10 pr-10 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
    />
    @if (searchQuery()) {
    <button
      (click)="clearSearch()"
      class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 touch-manipulation"
    >
      <ng-icon name="lucideX" size="20" />
    </button>
    }
  </div>

  @if (searchResults().length > 0) {
  <div
    class="mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-64 overflow-y-auto"
  >
    @for (user of searchResults(); track user.id) {
    <button
      (click)="selectUser(user)"
      class="w-full px-3 md:px-4 py-2 md:py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-700 active:bg-gray-200 dark:active:bg-gray-600 flex items-center gap-2 md:gap-3 border-b border-gray-100 dark:border-gray-700 last:border-b-0 transition-colors touch-manipulation"
    >
      <hlm-avatar class="shrink-0">
        @if (getAvatarUrl(user)) {
        <img [src]="getAvatarUrl(user)" hlmAvatarImage [alt]="user.username || user.email" />
        }
        <span class="text-white bg-destructive" hlmAvatarFallback>
          {{ (user.username || user.email).charAt(0).toUpperCase() }}
        </span>
      </hlm-avatar>
      <div class="min-w-0 flex-1">
        <div class="font-medium text-sm md:text-base text-gray-900 dark:text-gray-100 truncate">
          {{ user.username || user.email }}
        </div>
        @if (user.username && user.email) {
        <div class="text-xs md:text-sm text-gray-500 dark:text-gray-400 truncate">
          {{ user.email }}
        </div>
        }
      </div>
    </button>
    }
  </div>
  } @if (isSearching()) {
  <div class="mt-2 text-center text-gray-500 dark:text-gray-400 py-2">
    <ng-icon name="lucideSearch" class="animate-pulse mx-auto" size="24" />
  </div>
  } @if (searchQuery().length >= 2 && searchResults().length === 0 && !isSearching()) {
  <div class="mt-2 text-center text-gray-500 dark:text-gray-400 text-xs md:text-sm py-2">
    No users found
  </div>
  }
</div>
